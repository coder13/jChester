/*
 *  jChester - v0.7.0
 *  A time entry component for speedcubing solves.
 *  https://github.com/jfly/jChester
 *
 *  Made by Jeremy Fleischman
 *  Under GPL-3.0 License
 */
!function(a){if(a){var b=80,c=45;a.fn.jChester=function(d,e){if(!this.is("div"))throw"jChester can only be applied to divs";a.isPlainObject(d)&&(e=d,d=null);var f=["millis","moveCount","puzzlesSolvedCount","puzzlesAttemptedCount"],g=this,h=a.extend({},a.fn.jChester.defaults,e),i=this.data("datepicker");i||(i={},this.data("datepicker",i),i.$form=a('<form class="form-inline" role="form">'),g.append(i.$form),i.$form.append(a('<div class="form-group"><input type="text" name="millis-mask" class="form-control" readonly tabindex="-1"></input><input name="millis" type="text" class="form-control"></input></div>')),i.$form.find('input[name="millis-mask"]').css({position:"absolute",backgroundColor:"white",fontFamily:"monospace",textAlign:"right"}),i.$form.find('input[name="millis"]').css({position:"relative",backgroundColor:"transparent",fontFamily:"monospace",textAlign:"right"}),i.$form.append(a('<div class="form-group"><input name="moveCount" type="text" class="form-control"></input></div>')),i.$form.append(document.createTextNode(" ")),i.$form.append(a('<div class="form-group"><input name="puzzlesSolvedCount" min="0" type="number" class="form-control"></input></div>')),i.$form.append(a('<span name="puzzlesAttemptedCount">&nbsp;/&nbsp;</span>')),i.$form.append(a('<div class="form-group"><input name="puzzlesAttemptedCount" min="0" type="number" class="form-control"></input></div>')),i.$form.append(a('<span class="help-block">')),i.$form.find('input[type="text"]').width(b),i.$form.find('input[type="number"]').width(c),i.$form.find(".form-group").css({display:"inline-block"}),i.inputChanged=function(){var b={},c=null;if(i.editableSolveTimeFields.millis){var d=i.$form.find('input[name="millis"]'),e=i.$form.find('input[name="millis-mask"]'),g=d.val();if(g=g.replace(/ /g,""),g.match(/^\d+$/)){var h=7;g.length>h&&(g=g.substring(0,h));var j=g.length,k=g.substring(j-2,j),l=g.substring(j-4,j-2),m=g.substring(j-6,j-4),n=g.substring(0,j-6),o="",p="",q=function(a,b){for(var c=0;c<b-a.length;c++)o+=" ",p+="0";o+=a,p+=a};n.length>0&&(q(n,1),q(":",0)),m.length>0&&(q(m,p.length>0?2:1),q(":",0)),q(l,p.length>0?2:1),q(".",0),q(k,2),d.val(o.replace(/[.:]/g," ")),e.val(p),g=o.replace(/ /g,"0")}else g!==d.val()&&d.val(g),e.val("");try{c=jChester.stopwatchFormatToSolveTime(g)}catch(r){b.millis=0===g.length?"Please enter a time.":r}}if(i.editableSolveTimeFields.moveCount){var s=i.$form.find('input[name="moveCount"]').val();try{c?a.extend(c,jChester.stopwatchFormatToSolveTime(s,!0)):c=jChester.stopwatchFormatToSolveTime(s,!0)}catch(r){b.moveCount=0===s.length?"Please enter a number of moves.":r}}var t,u;if(i.hideField={},c)if(jChester.solveTimeIsDNF(c))t="0",u="1",i.hideField.puzzlesSolvedCount=!0,i.hideField.puzzlesAttemptedCount=!0;else if(jChester.solveTimeIsDNS(c))t="0",u="0",i.hideField.puzzlesSolvedCount=!0,i.hideField.puzzlesAttemptedCount=!0;else if(i.editableSolveTimeFields.puzzlesSolvedCount||i.editableSolveTimeFields.puzzlesAttemptedCount){var v=i.$form.find('input[name="puzzlesSolvedCount"]');t=v.val();var w=i.$form.find('input[name="puzzlesAttemptedCount"]');u=w.val()}else t="1",u="1";else t=null,u=null,i.hideField.puzzlesSolvedCount=!0,i.hideField.puzzlesAttemptedCount=!0;if(c){if(jChester._isInt(t)){var x=parseInt(t);c.puzzlesSolvedCount=x}else b.puzzlesSolvedCount="Invalid number of puzzles solved.";if(jChester._isInt(u)){var y=parseInt(u);c.puzzlesAttemptedCount=y,!b.puzzlesSolvedCount&&c.puzzlesSolvedCount>c.puzzlesAttemptedCount&&(b.puzzlesAttemptedCount="Cannot have more puzzles solved than attemped.")}else b.puzzlesAttemptedCount="Invalid number of puzzles attempted."}var z=function(a){return b[a]};i.validationErrors=f.filter(z).map(z),i.validationErrors.length>0&&(c=null),i.solveTime=c,i.$form.find(".help-block").text(i.validationErrors.join(" ")),i.$form.find(".input-group").removeClass("has-error"),f.forEach(function(a){var c=i.$form.find('input[name="'+a+'"]'),d=c.parent(".form-group"),e=!!b[a];d.toggleClass("has-error",e)}),f.forEach(function(a){var b=i.editableSolveTimeFields[a]&&!i.hideField[a];b=!!b,i.$form.find('input[name="'+a+'"]').parent().toggle(b),i.$form.find('span[name="'+a+'"]').toggle(b)})},i.$form.find("input").on("input",function(){i.inputChanged(),g.trigger("solveTimeInput",[i.validationErrors,i.solveTime])}),i.$form.find("input").on("keydown",function(b){var c=a(b.currentTarget);("millis"===c.attr("name")||"moveCount"===c.attr("name"))&&!b.altKey&&!b.ctrlKey&!b.metaKey&&(106===b.which||68===b.which?(c.val("DNF"),c.select(),i.inputChanged(),g.trigger("solveTimeInput",[[],i.solveTime]),b.preventDefault()):(111===b.which||83===b.which)&&(c.val("DNS"),c.select(),i.inputChanged(),g.trigger("solveTimeInput",[[],i.solveTime]),b.preventDefault()))}),this.attr("tabindex","-1"),this.focus(function(){var b=a(this).find("input:visible:not([readonly])").first();b.focus(),b.select()}));var j=function(a){if(null===a)i.$form.find('input[name="millis"]').val(""),i.$form.find('input[name="moveCount"]').val(""),i.$form.find('input[name="puzzlesSolvedCount"]').val(""),i.$form.find('input[name="puzzlesAttemptedCount"]').val(""),i.inputChanged();else if(a){var b="";jChester.solveTimeIsDNF(a)?b="DNF":jChester.solveTimeIsDNS(a)&&(b="DNS");var c;c=a.millis?jChester.solveTimeToStopwatchFormat(a,!0):b,i.$form.find('input[name="millis"]').val(c);var d;d=a.moveCount?a.moveCount:b,i.$form.find('input[name="moveCount"]').val(d),i.$form.find('input[name="puzzlesSolvedCount"]').val(a.puzzlesSolvedCount),i.$form.find('input[name="puzzlesAttemptedCount"]').val(a.puzzlesAttemptedCount),i.inputChanged()}};if("getSolveTime"===d)return i.solveTime;if("setSolveTime"===d){var k=arguments[1];return void j(k)}if("getValidationErrors"===d)return i.validationErrors;if(d)throw"Unrecognized method: "+d;return i.editableSolveTimeFields=h.editableSolveTimeFields,i.inputChanged(),j(h.solveTime),g},a.fn.jChester.defaults={solveTime:null,editableSolveTimeFields:{millis:!0}}}}("undefined"==typeof jQuery?null:jQuery);var MILLIS_PER_SECOND=1e3,MILLIS_PER_MINUTE=60*MILLIS_PER_SECOND,MILLIS_PER_HOUR=60*MILLIS_PER_MINUTE;jChester={stopwatchFormatToSolveTime:function(a,b){if(0===a.length)return null;if("DNF"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:1};if("DNS"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:0};if(b){if(!jChester._isInt(a))throw"Invalid move count.";var c=parseInt(a);if(0>=c)throw"Move count must be greater than zero.";return{moveCount:c}}var d=a.match(/^(?:(\d*):)??(?:(\d*):)?(\d+)?(?:[.,](\d*))?$/);if(!d)throw"Invalid stopwatch format.";var e=parseInt(d[1]||"0"),f=parseInt(d[2]||"0"),g=parseInt(d[3]||"0"),h=d[4]||"",i=parseInt(h||"0"),j=Math.pow(10,h.length-3),k=i?Math.round(i/j):0,l=e*MILLIS_PER_HOUR+f*MILLIS_PER_MINUTE+g*MILLIS_PER_SECOND+k;if(0>=l)throw"Time must be greater than zero.";var m=Math.min(3,h.length);return{millis:l,decimals:m}},solveTimeIsDNF:function(a){if("undefined"!=typeof a.puzzlesSolvedCount&&"undefined"!=typeof a.puzzlesAttemptedCount)if(1===a.puzzlesAttemptedCount){if(0===a.puzzlesSolvedCount)return!0}else if(a.puzzlesAttemptedCount>1){var b=a.puzzlesAttemptedCount-a.puzzlesSolvedCount,c=a.puzzlesSolvedCount-b;if(0>c||1===a.puzzlesSolvedCount)return!0}return!1},solveTimeIsDNS:function(a){return"undefined"!=typeof a.puzzlesAttemptedCount&&0===a.puzzlesAttemptedCount?!0:!1},solveTimeIsDN:function(a){return jChester.solveTimeIsDNF(a)||jChester.solveTimeIsDNS(a)},solveTimeToStopwatchFormat:function(a,b){function c(a,b,c){for(var d=a+"";d.length<c;)d=b+d;return d}if(!a)return"";if(!b){if(jChester.solveTimeIsDNF(a))return"DNF";if(jChester.solveTimeIsDNS(a))return"DNS"}if(a.moveCount)return a.moveCount.toFixed(a.decimals||0);var d=a.millis,e=Math.floor(d/MILLIS_PER_HOUR);d%=MILLIS_PER_HOUR;var f=Math.floor(d/MILLIS_PER_MINUTE);d%=MILLIS_PER_MINUTE;var g=Math.floor(d/MILLIS_PER_SECOND);d%=MILLIS_PER_SECOND;var h="";h.length>0?h+=":"+c(e,"0",2):e&&(h+=e),h.length>0?h+=":"+c(f,"0",2):f&&(h+=f),h+=h.length>0?":"+c(g,"0",2):g;var i=a.decimals;if(i>0){i=Math.min(3,i);var j=c(d,"0",3);h+=".";for(var k=0;i>k;k++)h+=j.charAt(k)}return h},_isInt:function(a){return 0===a.length?!1:+a%1===0}};