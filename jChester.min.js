/*
 *  jChester - v0.5.4
 *  A time entry component for speedcubing solves.
 *  https://github.com/jfly/jChester
 *
 *  Made by Jeremy Fleischman
 *  Under GPL-3.0 License
 */
!function(a){function b(a){return 0===a.length?!1:+a%1===0}var c=75,d=45;a.fn.jChester=function(e,f){if(!this.is("div"))throw"jChester can only be applied to divs";a.isPlainObject(e)&&(f=e,e=null);var g=["millis","moveCount","puzzlesSolvedCount","puzzlesAttemptedCount"],h=this,i=a.extend({},a.fn.jChester.defaults,f),j=this.data("datepicker");j||(j={},this.data("datepicker",j),j.$form=a('<form class="form-inline" role="form">'),h.append(j.$form),j.$form.append(a('<div class="form-group"><input type="text" name="millis-mask" class="form-control" readonly tabindex="-1"></input><input name="millis" type="text" class="form-control"></input></div>')),j.$form.find('input[name="millis-mask"]').css({position:"absolute",backgroundColor:"white",fontFamily:"monospace",textAlign:"right"}),j.$form.find('input[name="millis"]').css({position:"relative",backgroundColor:"transparent",fontFamily:"monospace",textAlign:"right"}),j.$form.append(a('<div class="form-group"><input name="moveCount" type="text" class="form-control"></input></div>')),j.$form.append(document.createTextNode(" ")),j.$form.append(a('<div class="form-group"><input name="puzzlesSolvedCount" min="0" type="number" class="form-control"></input></div>')),j.$form.append(a('<span name="puzzlesAttemptedCount">&nbsp;/&nbsp;</span>')),j.$form.append(a('<div class="form-group"><input name="puzzlesAttemptedCount" min="0" type="number" class="form-control"></input></div>')),j.$form.append(a('<span class="help-block">')),j.$form.find('input[type="text"]').width(c),j.$form.find('input[type="number"]').width(d),j.$form.find(".form-group").css({display:"inline-block"}),j.inputChanged=function(){var c={},d={};if(j.editableSolveTimeFields.millis){var e=j.$form.find('input[name="millis"]'),f=j.$form.find('input[name="millis-mask"]'),h=e.val();if(h=h.replace(/ /g,""),h.match(/^\d+$/)){var i=6;h.length>i&&(h=h.substring(0,i));var k=h.length,l=h.substring(k-2,k),m=h.substring(k-4,k-2),n=h.substring(0,k-4),o="",p="",q=function(a,b){for(var c=0;c<b-a.length;c++)o+=" ",p+="0";o+=a,p+=a};q(n,2),q(":",0),q(m,2),q(".",0),q(l,2),e.val(o.replace(/[.:]/g," ")),f.val(p),h=o.replace(/ /g,"0")}else h!==e.val()&&e.val(h),f.val("");try{a.extend(d,a.stopwatchFormatToSolveTime(h))}catch(r){c.millis=0===h.length?"Please enter a time.":r}}if(j.editableSolveTimeFields.moveCount){var s=j.$form.find('input[name="moveCount"]').val();try{a.extend(d,a.stopwatchFormatToSolveTime(s,!0))}catch(r){c.moveCount=0===s.length?"Please enter a number of moves.":r}}var t,u;if(j.hideField={},a.solveTimeIsDNF(d))t="0",u="1",j.hideField.puzzlesSolvedCount=!0,j.hideField.puzzlesAttemptedCount=!0;else if(a.solveTimeIsDNS(d))t="0",u="0",j.hideField.puzzlesSolvedCount=!0,j.hideField.puzzlesAttemptedCount=!0;else if(j.editableSolveTimeFields.puzzlesSolvedCount||j.editableSolveTimeFields.puzzlesAttemptedCount){var v=j.$form.find('input[name="puzzlesSolvedCount"]');t=v.val();var w=j.$form.find('input[name="puzzlesAttemptedCount"]');u=w.val()}else t="1",u="1";if(b(t)){var x=parseInt(t);d.puzzlesSolvedCount=x}else c.puzzlesSolvedCount="Invalid number of puzzles solved.";if(b(u)){var y=parseInt(u);d.puzzlesAttemptedCount=y,!c.puzzlesSolvedCount&&d.puzzlesSolvedCount>d.puzzlesAttemptedCount&&(c.puzzlesAttemptedCount="Cannot have more puzzles solved than attemped.")}else c.puzzlesAttemptedCount="Invalid number of puzzles attempted.";var z=function(a){return c[a]},A=g.filter(z).map(z);A.length>0&&(d=null),j.solveTime=d,j.$form.find(".help-block").text(A.join(" ")),j.$form.find(".input-group").removeClass("has-error"),g.forEach(function(a){var b=j.$form.find('input[name="'+a+'"]'),d=b.parent(".form-group"),e=!!c[a];d.toggleClass("has-error",e)}),g.forEach(function(a){var b=j.editableSolveTimeFields[a]&&!j.hideField[a];b=!!b,j.$form.find('input[name="'+a+'"]').parent().toggle(b),j.$form.find('span[name="'+a+'"]').toggle(b)})},j.$form.find("input").on("input",function(){j.inputChanged(),h.trigger("solveTimeInput",[j.solveTime])}),j.$form.find("input").on("keydown",function(b){var c=a(b.currentTarget);("millis"===c.attr("name")||"moveCount"===c.attr("name"))&&!b.altKey&&!b.ctrlKey&!b.metaKey&&(106===b.which||68===b.which?(c.val("DNF"),c.select(),j.inputChanged(),h.trigger("solveTimeInput",[j.solveTime]),b.preventDefault()):(111===b.which||83===b.which)&&(c.val("DNS"),c.select(),j.inputChanged(),h.trigger("solveTimeInput",[j.solveTime]),b.preventDefault()))}),this.attr("tabindex","-1"),this.focus(function(){var b=a(this).find("input:visible:not([readonly])").first();b.focus(),b.select()}));var k=function(b){if(null===b)j.$form.find('input[name="millis"]').val(""),j.$form.find('input[name="moveCount"]').val(""),j.$form.find('input[name="puzzlesSolvedCount"]').val(""),j.$form.find('input[name="puzzlesAttemptedCount"]').val(""),j.inputChanged();else if(b){var c="";a.solveTimeIsDNF(b)?c="DNF":a.solveTimeIsDNS(b)&&(c="DNS");var d;d=b.millis?a.solveTimeToStopwatchFormat(b,!0):c,j.$form.find('input[name="millis"]').val(d);var e;e=b.moveCount?b.moveCount:c,j.$form.find('input[name="moveCount"]').val(e),j.$form.find('input[name="puzzlesSolvedCount"]').val(b.puzzlesSolvedCount),j.$form.find('input[name="puzzlesAttemptedCount"]').val(b.puzzlesAttemptedCount),j.inputChanged()}};if("getSolveTime"===e)return j.solveTime;if("setSolveTime"===e){var l=arguments[1];return void k(l)}if(e)throw"Unrecognized method: "+e;return j.editableSolveTimeFields=i.editableSolveTimeFields,j.inputChanged(),k(i.solveTime),h},a.fn.jChester.defaults={solveTime:null,editableSolveTimeFields:{millis:!0}};var e=1e3,f=60*e;a.extend({stopwatchFormatToSolveTime:function(a,c){if(0===a.length)throw"Input must be nonempty.";if("DNF"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:1};if("DNS"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:0};if(c){if(!b(a))throw"Invalid move count.";var d=parseInt(a);if(0>=d)throw"Move count must be greater than zero.";return{moveCount:d}}var g=a.match(/^(?:(\d*):)?(\d+)?(?:[.,](\d*))?$/);if(!g)throw"Invalid stopwatch format.";var h=parseInt(g[1]||"0"),i=parseInt(g[2]||"0"),j=g[3]||"",k=parseInt(j||"0"),l=Math.pow(10,j.length-3),m=k?Math.round(k/l):0,n=h*f+i*e+m,o=Math.min(3,j.length);return{millis:n,decimals:o}},solveTimeIsDNF:function(a){if("undefined"!=typeof a.puzzlesSolvedCount&&"undefined"!=typeof a.puzzlesAttemptedCount)if(1===a.puzzlesAttemptedCount){if(0===a.puzzlesSolvedCount)return!0}else if(a.puzzlesAttemptedCount>1){var b=a.puzzlesAttemptedCount-a.puzzlesSolvedCount,c=a.puzzlesSolvedCount-b;if(0>c||1===a.puzzlesSolvedCount)return!0}return!1},solveTimeIsDNS:function(a){return"undefined"!=typeof a.puzzlesAttemptedCount&&0===a.puzzlesAttemptedCount?!0:!1},solveTimeToStopwatchFormat:function(b,c){function d(a,b,c){for(var d=a+"";d.length<c;)d=b+d;return d}if(!c){if(a.solveTimeIsDNF(b))return"DNF";if(a.solveTimeIsDNS(b))return"DNS"}var e=b.millis,f=Math.floor(e/6e4);e%=6e4;var g=Math.floor(e/1e3);e%=1e3;var h;h=f?f+":"+d(g,"0",2):""+g;var i=b.decimals;if(i>0){i=Math.min(3,i);var j=d(e,"0",3);h+=".";for(var k=0;i>k;k++)h+=j.charAt(k)}return h}})}(jQuery);